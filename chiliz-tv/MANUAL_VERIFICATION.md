# Manual Contract Verification Guide for Chiliz

Your contracts deployed successfully but automatic verification failed due to Chiliz block explorer API issues.

---

## Quick Summary

‚úÖ **Contracts are deployed and working**  
‚ùå **Auto-verification blocked by CloudFront (403 error)**  
‚úÖ **Solution: Verify manually via web interface**

---

## Method 1: Web UI Verification (Easiest)

### Step 1: Get Your Contract Address
From deployment output, find addresses like:
```
StreamWallet Implementation: 0x6135eae6eaca29fc0f6df0483e6054850c5b4994
StreamWalletFactory: 0xe15614e7d6864f0d79f84a01b44de34150761f64
```

### Step 2: Visit Block Explorer
Go to: https://testnet.chiliscan.com/address/<YOUR_CONTRACT_ADDRESS>

### Step 3: Click "Contract" Tab
Then click "Verify & Publish"

### Step 4: Fill the Form
- **Compiler Type**: Solidity (Single file)
- **Compiler Version**: v0.8.24+commit.e11b9ed9
- **Open Source License**: MIT
- **Optimization**: Yes (200 runs)

### Step 5: Paste Contract Source
Get flattened source:
```bash
wsl -e bash -c "cd /mnt/e/Helder/GitHub_Repo/smart-contracts/chiliz-tv && \
  forge flatten src/streamer/StreamWallet.sol > StreamWallet_flat.sol"
```

Copy contents of `StreamWallet_flat.sol` and paste into verification form.

### Step 6: Submit
Click "Verify & Publish"

---

## Method 2: Forge Verify (Command Line)

Try verification separately after deployment:

```bash
# Verify StreamWallet Implementation
wsl -e bash -c "cd /mnt/e/Helder/GitHub_Repo/smart-contracts/chiliz-tv && \
  forge verify-contract \
    0x6135eae6eaca29fc0f6df0483e6054850c5b4994 \
    src/streamer/StreamWallet.sol:StreamWallet \
    --chain-id 88882 \
    --verifier blockscout \
    --verifier-url https://testnet.chiliscan.com/api"

# Verify StreamWalletFactory
wsl -e bash -c "cd /mnt/e/Helder/GitHub_Repo/smart-contracts/chiliz-tv && \
  forge verify-contract \
    0xe15614e7d6864f0d79f84a01b44de34150761f64 \
    src/streamer/StreamWalletFactory.sol:StreamWalletFactory \
    --chain-id 88882 \
    --verifier blockscout \
    --verifier-url https://testnet.chiliscan.com/api \
    --constructor-args \$(cast abi-encode 'constructor(address,address,address,uint16)' \
      0x1804c8AB1F12E6bbf3894d4083f33e07309d1f38 \
      0x6135eae6eaca29fc0f6df0483e6054850c5b4994 \
      0x74E2653e4e0Adf2cb9a56C879d4C28ad0294D677 \
      500)"
```

---

## Method 3: Hardhat Verify (Alternative)

If forge keeps failing, use Hardhat:

### Install Hardhat
```bash
npm install --save-dev hardhat @nomiclabs/hardhat-etherscan
```

### Create hardhat.config.js
```javascript
require("@nomiclabs/hardhat-etherscan");

module.exports = {
  solidity: "0.8.24",
  networks: {
    chilizTestnet: {
      url: "https://spicy-rpc.chiliz.com",
      chainId: 88882,
    }
  },
  etherscan: {
    apiKey: {
      chilizTestnet: "your-api-key" // May not be required
    },
    customChains: [
      {
        network: "chilizTestnet",
        chainId: 88882,
        urls: {
          apiURL: "https://testnet.chiliscan.com/api",
          browserURL: "https://testnet.chiliscan.com"
        }
      }
    ]
  }
};
```

### Verify
```bash
npx hardhat verify --network chilizTestnet 0xYOUR_CONTRACT_ADDRESS
```

---

## Why Did This Happen?

### Root Cause
Chiliz block explorer (chiliscan.com) uses **CloudFront CDN** with aggressive rate limiting that blocks automated tools.

### The 403 Error
```
403 ERROR
The request could not be satisfied.
Request blocked.
Generated by cloudfront (CloudFront)
```

This means:
- ‚úÖ Your deployment succeeded
- ‚ùå Verification API rejected the request
- üîí Likely anti-bot protection

### Common Triggers
1. **Too many requests** - Multiple verification attempts
2. **Missing headers** - CloudFront expects browser-like requests
3. **Rate limiting** - API throttling automated tools
4. **Wrong endpoint** - API URL may have changed

---

## Workarounds

### Option A: Wait and Retry
CloudFront blocks are usually temporary (15-60 minutes):
```bash
# Wait 1 hour, then retry
sleep 3600 && forge verify-contract ...
```

### Option B: Use Different IP
CloudFront blocks by IP. Try:
- VPN to different region
- Different network (mobile hotspot)
- Cloud shell (GitHub Codespaces, Google Cloud Shell)

### Option C: Contact Chiliz Support
Report the verification issue:
- Telegram: https://t.me/chiliz
- Discord: https://discord.gg/chiliz
- Twitter: @chiliz

---

## Verification Status Check

After manual verification, check if it worked:

```bash
# Check if contract is verified
cast call 0xYOUR_CONTRACT_ADDRESS "owner()(address)" --rpc-url https://spicy-rpc.chiliz.com

# View on explorer
https://testnet.chiliscan.com/address/0xYOUR_CONTRACT_ADDRESS#code
```

If you see the green ‚úì checkmark and "Contract Source Code Verified", you're done!

---

## Important Notes

### Your Contracts ARE Deployed ‚úÖ
Even without verification, your contracts:
- ‚úÖ Are live on blockchain
- ‚úÖ Can be called/used normally
- ‚úÖ Are upgradeable (if UUPS)
- ‚úÖ Function exactly as designed

### Verification is Optional
Verification only:
- üìñ Makes code readable on explorer
- üîç Helps users trust the contract
- üìù Enables "Read/Write Contract" UI
- üèÜ Looks professional

But it's **NOT required for functionality**.

---

## Quick Deploy Without Verification

To deploy without verification headaches:

```bash
wsl -e bash -c "cd /mnt/e/Helder/GitHub_Repo/smart-contracts/chiliz-tv && \
  ./deploy.sh testnet streaming"
```

Then verify manually via web UI later.

---

**Last Updated**: December 3, 2025  
**Issue**: Chiliz CloudFront blocking forge verification  
**Status**: Known issue, manual verification required
